<div class="page-shell">
  <header class="page-header">
    <div class="page-title">Juan Pablo Betancourt Portfolio</div>
    <span class="spacer"></span>
    <button mat-icon-button class="header-menu-btn" [matMenuTriggerFor]="topMenu">
      <mat-icon>menu</mat-icon>
    </button>
    <mat-menu #topMenu="matMenu">
      <button mat-menu-item (click)="setViewMode('companies')">
        <mat-icon>business</mat-icon>
        <span>Companies</span>
      </button>
      <button mat-menu-item (click)="setViewMode('projects')">
        <mat-icon>work</mat-icon>
        <span>Projects</span>
      </button>
      <button mat-menu-item (click)="setViewMode('all')">
        <mat-icon>dashboard</mat-icon>
        <span>Show all</span>
      </button>
    </mat-menu>
  </header>

  <div class="content-grid">
    <section class="chat-panel">
      <div class="chat-container">
        <div class="messages-container" #messagesContainer>
          <div class="messages-list">
            <div
              *ngFor="let message of messages"
              [class.user-message]="message.isUser"
              [class.ai-message]="!message.isUser"
              class="message"
            >
              <mat-card class="message-card">
                <mat-card-content>
                  <div class="message-header">
                    <img *ngIf="!message.isUser" src="assets/jpicon.png" class="ai-avatar" alt="AI Assistant" />
                    <mat-icon *ngIf="message.isUser">person</mat-icon>
                    <span class="message-time">{{ message.timestamp | date: 'short' }}</span>
                  </div>
                  <div class="message-content">
                    {{ message.content }}
                  </div>

                  <!-- JPB: Document Sources - Hidden per user request -->
                  <!-- <mat-expansion-panel *ngIf="message.sources && message.sources.length > 0" class="sources-panel">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <mat-icon>description</mat-icon>
                        Sources ({{ message.sources.length }})
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="sources-list">
                      <div *ngFor="let source of message.sources" class="source-item">
                        <div class="source-header">
                          <strong>{{ source.fileName }}</strong>
                          <span class="relevance-score">Relevance: {{ (source.relevanceScore * 100).toFixed(0) }}%</span>
                        </div>
                        <div class="source-content">{{ source.content }}</div>
                      </div>
                    </div>
                  </mat-expansion-panel> -->
                </mat-card-content>
              </mat-card>
            </div>

            <!-- Loading indicator -->
            <div *ngIf="isLoading" class="message ai-message">
              <mat-card class="message-card loading-card">
                <mat-card-content>
                  <div class="loading-content">
                    <mat-spinner diameter="30"></mat-spinner>
                    <span>Thinking...</span>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </div>

        <div class="input-container">
          <mat-card class="input-card">
            <mat-card-content class="input-content">
              <button mat-icon-button (click)="clearChat()" matTooltip="Clear chat">
                <mat-icon>refresh</mat-icon>
              </button>
              <mat-form-field class="message-input" appearance="outline">
                <mat-label>Ask me anything...</mat-label>
                <textarea
                  matInput
                  [(ngModel)]="userInput"
                  (keypress)="onKeyPress($event)"
                  [disabled]="isLoading"
                  rows="2"
                  placeholder="e.g., What are your technical skills?"
                ></textarea>
              </mat-form-field>
              <button mat-raised-button color="primary" (click)="sendMessage()" [disabled]="!userInput.trim() || isLoading">
                <mat-icon>send</mat-icon>
              </button>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </section>

    <aside class="right-panel">
      <section class="info-card">
        <div class="card-title">Quick links</div>
        <div class="link-list">
          <a
            class="link-item"
            *ngFor="let link of quickLinks"
            [href]="link.url"
            target="_blank"
            rel="noopener"
            [attr.download]="link.downloadName || null"
          >
            <mat-icon>{{ link.icon }}</mat-icon>
            <div class="link-text">
              <div class="link-label">{{ link.label }}</div>
              <div class="link-note">{{ link.note }}</div>
            </div>
          </a>
        </div>
      </section>

      <section class="info-card" *ngIf="viewMode !== 'projects'">
        <div class="card-title">Companies</div>
        <div class="company-grid">
          <a
            class="company-card"
            *ngFor="let company of companies"
            [href]="company.url"
            target="_blank"
            rel="noopener"
          >
            <img [src]="company.logo" [alt]="company.name" class="company-logo" />
            <div class="company-name">{{ company.name }}</div>
            <div class="company-projects">
              <span class="project-pill" *ngFor="let project of company.projects">{{ project }}</span>
            </div>
          </a>
        </div>
      </section>

      <section class="info-card" *ngIf="viewMode !== 'companies'">
        <div class="card-title">Projects</div>
        <div class="project-list">
          <a
            class="project-item"
            *ngFor="let project of projects"
            [href]="project.url"
            target="_blank"
            rel="noopener"
          >
            <div class="project-header">
              <mat-icon>folder</mat-icon>
              <div>
                <div class="project-name">{{ project.name }}</div>
                <div class="project-company">{{ project.company }}</div>
              </div>
            </div>
            <div class="project-summary">{{ project.summary }}</div>
          </a>
        </div>
      </section>
    </aside>
  </div>
</div>
